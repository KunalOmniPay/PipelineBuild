pipeline{
  agent {
    docker {
      image 'maven:3-alpine'
      args '-v /root/.m2:/root/.m2'
    }
  }
  stages {
    stage('Build'){
      steps{
        sh 'mvn compile'
        sh 'mvn package'
      }
     }
    stage('Test'){
      steps{
        sh 'mvn test'
      }
      }
     stage('collect artifact'){
     steps{
     archiveArtifacts artifacts: 'target/*.jar', followSymlinks: false
     }
     }
       stage('SonarQube analysis') {
    withSonarQubeEnv(credentialsId: 'b96723e9-a53e-4a1c-8eef-90c5f2f4591d', installationName: 'My SonarQube Server') { // You can override the credential to be used
      sh 'mvn org.sonarsource.scanner.maven:sonar-maven-plugin:3.7.0.1746:sonar'
    }
  }
      
  
  }
  }

